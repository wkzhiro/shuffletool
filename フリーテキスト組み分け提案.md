# フリーテキスト組み分けロジック提案

## 概要
現在のタグベース組み分けに加えて、フリーテキスト（自由記述）をベースとした組み分けロジックの追加提案

## 提案手法

### 1. キーワードベースマッチング
**実装難易度**: ★☆☆ (簡単)  
**効果**: ★★☆ (中程度)  
**処理速度**: ★★★ (高速)

#### 概要
- 事前定義されたキーワード辞書でテキストを分類
- 部分一致または完全一致で判定
- 管理者がキーワードを設定可能

#### 実装方法
```python
keyword_groups = {
    "技術系": ["Python", "Java", "AI", "機械学習", "プログラミング"],
    "デザイン系": ["UI", "UX", "デザイン", "Photoshop", "Figma"],
    "ビジネス系": ["マーケティング", "営業", "企画", "戦略"]
}
```

#### メリット
- 実装が簡単
- 処理が高速
- 結果が予測しやすい
- 既存システムへの統合が容易

#### デメリット
- キーワード辞書の事前準備が必要
- 新しい表現への対応が困難
- 同音異義語の判定が困難

---

### 2. TF-IDF + クラスタリング
**実装難易度**: ★★☆ (中程度)  
**効果**: ★★★ (高)  
**処理速度**: ★★☆ (中程度)

#### 概要
- TF-IDF (Term Frequency-Inverse Document Frequency) で文書をベクトル化
- K-meansクラスタリングで自動グループ分け
- 教師なし学習でパターンを発見

#### 実装方法
```python
from sklearn.feature_extraction.text import TfidfVectorizer
from sklearn.cluster import KMeans

def tfidf_clustering(texts, n_groups=3):
    vectorizer = TfidfVectorizer()
    tfidf_matrix = vectorizer.fit_transform(texts)
    kmeans = KMeans(n_clusters=n_groups)
    clusters = kmeans.fit_predict(tfidf_matrix)
    return clusters
```

#### メリット
- 自動でパターンを発見
- 事前知識不要
- 統計的に意味のあるグループ化

#### デメリット
- グループ数を事前指定が必要
- 結果の解釈が困難な場合がある
- 日本語の場合は前処理が重要

---

### 3. 日本語形態素解析
**実装難易度**: ★★☆ (中程度)  
**効果**: ★★★ (高)  
**処理速度**: ★★☆ (中程度)

#### 概要
- MeCabやjanomeで日本語を単語に分割
- 名詞、動詞などの品詞情報を活用
- より精密な日本語テキスト分析

#### 実装方法
```python
from janome.tokenizer import Tokenizer

def extract_keywords(text):
    tokenizer = Tokenizer()
    keywords = []
    for token in tokenizer.tokenize(text):
        if token.part_of_speech.split(',')[0] == '名詞':
            keywords.append(token.surface)
    return keywords
```

#### メリット
- 日本語に特化した精密分析
- 品詞情報で重要語句を抽出
- 表記ゆれに対応可能

#### デメリット
- 形態素解析ツールの導入が必要
- 処理時間がやや長い
- 専門用語の辞書整備が必要な場合がある

---

### 4. 埋め込みベクトル（Sentence Transformers）
**実装難易度**: ★★★ (高)  
**効果**: ★★★ (高)  
**処理速度**: ★☆☆ (低)

#### 概要
- 事前学習済みモデルでテキストを高次元ベクトル化
- 意味的類似性を考慮したグループ化
- 最新の自然言語処理技術を活用

#### 実装方法
```python
from sentence_transformers import SentenceTransformer
from sklearn.cluster import DBSCAN

def semantic_grouping(texts):
    model = SentenceTransformer('paraphrase-multilingual-MiniLM-L12-v2')
    embeddings = model.encode(texts)
    clustering = DBSCAN(eps=0.5, min_samples=2)
    clusters = clustering.fit_predict(embeddings)
    return clusters
```

#### メリット
- 意味的類似性を考慮
- 言語横断的な対応
- 高い分類精度

#### デメリット
- 大容量のモデルファイルが必要
- 初回実行時の処理時間が長い
- 計算リソースの消費が大きい

---

## 推奨実装ステップ

### Phase 1: キーワードベース実装
- **期間**: 1-2週間
- **目標**: 基本的なフリーテキスト分類機能
- **内容**: 
  - キーワード辞書設定UI
  - 部分一致での分類ロジック
  - 既存システムとの統合

### Phase 2: 形態素解析拡張
- **期間**: 2-3週間
- **目標**: 日本語テキストの精密分析
- **内容**:
  - janome導入と設定
  - 名詞抽出による重要語句特定
  - キーワード自動発見機能

### Phase 3: 機械学習ベース
- **期間**: 3-4週間
- **目標**: 自動クラスタリング機能
- **内容**:
  - TF-IDFクラスタリング実装
  - ユーザー評価による改善機能
  - 結果可視化機能

### Phase 4: 高度な意味解析
- **期間**: 4-6週間
- **目標**: 意味的類似性による高精度分類
- **内容**:
  - Sentence Transformers導入
  - 埋め込みベクトルクラスタリング
  - ハイブリッド手法の検討

---

## 技術要件

### 必要なライブラリ
```python
# Phase 1: キーワードベース
# 追加ライブラリなし（標準ライブラリのみ）

# Phase 2: 形態素解析
pip install janome

# Phase 3: 機械学習
pip install scikit-learn

# Phase 4: 埋め込みベクトル
pip install sentence-transformers torch
```

### システム要件
- **メモリ**: 最低4GB、推奨8GB以上
- **ストレージ**: 追加で1-2GB（モデルファイル用）
- **CPU**: マルチコア推奨（Phase 4以降）

---

## 現在システムとの統合案

### UI拡張
```python
# カテゴリ処理方法選択
processing_method = st.selectbox(
    "フリーテキスト処理方法",
    ["従来のグループ分け", "キーワードベース", "自動クラスタリング", "意味解析"]
)

# キーワード設定（キーワードベース選択時）
if processing_method == "キーワードベース":
    st.subheader("キーワードグループ設定")
    # キーワード入力UI
```

### データ構造拡張
```python
# 新しい列の追加
df["text_group"] = assign_text_groups(df["free_text_column"], method)
df["text_score"] = calculate_text_similarity_score(df["text_group"])
```

### スコア計算拡張
```python
# フリーテキストグループの一致度もスコアに反映
text_score_weight = st.slider("フリーテキスト重み", 0, 5, 2)
total_score = tag_score + (text_score * text_score_weight)
```

---

## 期待効果

### Phase 1完了時
- フリーテキスト情報を考慮した組み分けが可能
- ユーザーの詳細な希望・スキルを反映

### Phase 2完了時  
- 日本語テキストの精密な分析
- より自然な組み分け結果

### Phase 3完了時
- 管理者の設定作業を大幅削減
- データドリブンな組み分け

### Phase 4完了時
- 高精度な意味的類似性による組み分け
- 多言語対応の可能性

---

## リスク・注意点

### 技術的リスク
- 新しいライブラリ依存による環境構築の複雑化
- 処理時間の増加（特にPhase 4）
- メモリ使用量の増加

### 運用リスク
- 分類結果の解釈困難さ（特に機械学習ベース）
- パラメータ調整の必要性
- 継続的なメンテナンスの必要性

### 対策
- 段階的実装による影響範囲の限定
- フォールバック機能の実装
- 十分なテスト期間の確保
- ユーザー評価による継続改善